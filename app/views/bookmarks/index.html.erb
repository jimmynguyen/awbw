<div class="max-w-7xl mx-auto px-4 py-8">
  <div class="max-w-5xl mx-auto bg-white border border-gray-200 rounded-xl shadow p-6">
    <h1 class="text-2xl font-semibold text-gray-900 mb-4">Bookmarks (<%= @bookmarks_count %>)</h1>
    <div class="border-b border-gray-300 mb-6"></div>
    <div class="mt-4 pt-4">

      <!-- Filter form -->
      <%= form_tag('/bookmarks', method: :get, class: "space-y-4") do %>
        <%= render "search_fields" %>

        <!-- Sort options -->
        <div class="mt-4 flex flex-wrap items-center gap-4 my-6">
          <span class="font-semibold">Sort by:</span>
          <div class="flex flex-wrap gap-2">
            <%= render 'sortable_fields', sortable_fields: @sortable_fields %>
          </div>
        </div>
      <% end %>

      <!-- Bookmarks list -->
      <% if @bookmarks.any? %>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
            <thead>
            <tr class="bg-gray-100">
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">ID</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">User</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Type</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Title</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Created At</th>
            </tr>
            </thead>

            <tbody class="divide-y divide-gray-200">
            <% @bookmarks.each do |bookmark| %>
              <% item = bookmark.bookmarkable %>
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2"><%= bookmark.id %></td>
                <td class="px-4 py-2"><%= bookmark.user&.full_name %></td>
                <td class="px-4 py-2"><%= bookmark.bookmarkable_type %></td>
                <td class="px-4 py-2">
                  <% if item.respond_to?(:name) %>
                    <%= link_to item.name, polymorphic_path(item), class: "text-blue-600 hover:underline" %>
                  <% elsif item.respond_to?(:title) %>
                    <%= link_to item.title, polymorphic_path(item), class: "text-blue-600 hover:underline" %>
                  <% else %>
                    N/A
                  <% end %>
                </td>
                <td class="px-4 py-2"><%= bookmark.created_at.strftime("%b %d, %Y %H:%M") %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="mt-6 flex justify-center">
          <div class="pagination mt-6">
            <%= will_paginate @bookmarks,
                              previous_label: "<<",
                              next_label: ">>",
                              inner_window: 2,
                              class: "will-paginate-wrapper flex space-x-2 list-none p-0" %>
          </div>
        </div>
      <% else %>
        <p class="text-gray-600">No bookmarks found.</p>
      <% end %>

    </div>
  </div>
</div>

<script>
    // Search icon click
    document.querySelectorAll('.fa-search').forEach(icon => {
        icon.closest('div').addEventListener('click', () => {
            icon.closest('form').submit();
        });
    });

    // Category checkboxes submit on change
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".category-checkbox").forEach(function(checkbox) {
            checkbox.addEventListener("change", function() {
                this.form.submit();
            });
        });
    });
</script>
