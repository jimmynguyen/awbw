<%= simple_form_for @user, html: { multipart: true, class: "space-y-8" } do |f| %>
  <%= render 'shared/errors', resource: user if user.errors.any? %>

  <!-- Basic Info + Avatar -->
  <!-- Container -->
  <div class="flex gap-8 items-start">
    <!-- LEFT COLUMN: 75% -->
    <div class="flex-1" style="flex: 0 0 75%;">
      <div class="space-y-6">
        <div class="flex flex-col md:flex-row gap-4">
          <%= f.input :first_name, input_html: { class: "w-full" }, wrapper_html: { class: "w-full" } %>
          <%= f.input :last_name, input_html: { class: "w-full" }, wrapper_html: { class: "w-full" } %>
        </div>

        <div class="flex flex-col md:flex-row gap-4">
          <%= f.input :email, input_html: { class: "w-full" }, wrapper_html: { class: "w-full" } %>
          <div class="w-full md:w-auto">
            <%= f.label :birthday, "Birthday", required: true, class: "block font-medium mb-1" %>
            <%= f.text_field :birthday, type: 'date',
                             class: "w-full rounded border-gray-300 shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500",
                             value: @user.birthday&.strftime('%Y-%m-%d'),
                             required: true,
                             autocomplete: "bday" %>
          </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4">
          <%= f.input :inactive %>
          <%= f.input :super_user %>
        </div>

        <div class="flex flex-col md:flex-row gap-4">
          <%= f.input :phone %>
          <%= f.input :phone2 %>
          <%= f.input :phone3 %>
          <%= f.input :best_time_to_call %>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: 25% -->
    <div class="flex flex-col items-center gap-4" style="flex: 0 0 25%;">
      <%= f.label :avatar, class: "block font-medium mb-1 text-gray-700 string required" %>

      <% if @user.avatar.present? %>
        <%= image_tag @user.avatar.url(:thumb),
                      id: "avatar-preview",
                      class: "w-32 h-32 rounded-full object-cover border border-gray-300 shadow-sm" %>
      <% else %>
        <%= image_tag "missing.png",
                      id: "avatar-preview",
                      class: "w-32 h-32 rounded-full object-cover border border-dashed border-gray-300" %>
      <% end %>
      <div id="avatar-filename" class="text-center text-sm text-gray-500">
        <%= @user.avatar_file_name %>
      </div>

      <div class="relative w-36">
        <%= f.file_field :avatar, id: "avatar-input",
                         class: "absolute inset-0 w-full h-full opacity-0 cursor-pointer" %>
        <button type="button"
                class="w-full py-2 px-3 border border-gray-300 rounded-lg bg-white text-sm text-gray-700 hover:bg-gray-50">
          Choose file
        </button>
      </div>
    </div>
  </div>

  <!-- Primary Address Choice -->
  <div class="flex flex-col md:flex-row gap-4">
    <%= f.input :primary_address, collection: [['Work', 1], ['Home', 2]], prompt: "Select Primary Address" %>
  </div>

  <!-- Work Address -->
  <div>
    <h3 class="font-semibold text-gray-700 mb-2">Work Address</h3>
    <div class="flex flex-col md:flex-row gap-6 w-full">
      <%= f.input :address, label: 'Street', as: :text, input_html: { rows: 1 } %>
      <%= f.input :city, as: :text, input_html: { rows: 1 } %>
      <%= f.input :state %>
      <%= f.input :zip %>
    </div>
  </div>

  <!-- Home Address -->
  <div>
    <h3 class="font-semibold text-gray-700 mb-2">Home Address</h3>
    <div class="flex flex-col md:flex-row gap-6 w-full">
      <%= f.input :address2, label: 'Street2', as: :text, input_html: { rows: 1 } %>
      <%= f.input :city2, as: :text, input_html: { rows: 1 } %>
      <%= f.input :state2 %>
      <%= f.input :zip2 %>
    </div>
  </div>

  <!-- Notes -->
  <div>
    <%= f.input :notes, as: :text, input_html: { rows: 3, class: "w-full" } %>
  </div>

  <!-- Actions -->
  <!-- Action buttons -->
  <div class="mt-6 flex flex-wrap gap-3">
    <% if @user.persisted? %>
      <%= link_to "Delete", @user,
                  method: :delete,
                  data: { confirm: "Are you sure?" },
                  class: "btn btn-danger-outline" %>
    <% end %>

    <%= link_to 'Cancel', users_path,
                class: "btn btn-secondary-outline" %>

    <%= f.submit 'Submit',
                 class: "btn btn-primary" %>
  </div>
<% end %>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const input = document.getElementById("avatar-input");
        const filenameDisplay = document.getElementById("avatar-filename");

        input.addEventListener("change", function() {
            if (input.files.length > 0) {
                filenameDisplay.textContent = input.files[0].name;

                // preview the image
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById("avatar-preview");
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                filenameDisplay.textContent = "";
            }
        });
    });
</script>

