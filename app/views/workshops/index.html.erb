<div
  class="
    search-curriculum-page max-w-7xl mx-auto bg-white border border-gray-200
    rounded-xl shadow p-6
  "
>
  <!-- Header -->
  <div class="w-full">
    <div class="flex items-start justify-between mb-6">
      <div class="pr-6">
        <h2 class="text-2xl font-semibold mb-2">Workshops</h2>
        <p class="text-gray-700">
          Search by emotional theme, materials needed, ease of set-up and
          clean-up, and more.
          <br>
          We always encourage the creativity and innovation of each Windows
          Facilitator; if you adapt and improve workshops, please be sure to
          share your ideas with us!
        </p>
      </div>
      <% if current_user.super_user? %>
        <div class="admin-only bg-blue-100 p-3">
          <%= link_to_button "New workshop", new_workshop_path, variant: :primary_outline %>
        </div>
      <% end %>
    </div>
  </div>
  <!-- Divider -->
  <div class="w-full">
    <hr class="border-gray-300 mb-6">
  </div>
  <!-- Search Form -->
  <div class="w-full">
    <%= form_tag('/workshops', method: :get, class: "space-y-6") do %>
      <!-- Filters Header -->
      <div>
        <h3 class="text-sm font-semibold uppercase text-gray-500 tracking-wide">Search Filters</h3>
      </div>
      <!-- Search Fields -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <div class="relative">
            <%= text_field_tag :title,
            params[:title],
            placeholder: "Title",
            class:
              "w-full bg-white border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:ring-blue-500 focus:border-blue-500" %>
            <button
              type="submit"
              class="
                absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700
              "
            >
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>

        <div>
          <div class="relative">
            <%= text_field_tag :query,
            params[:query],
            placeholder: "Keywords",
            class:
              "w-full bg-white border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:ring-blue-500 focus:border-blue-500" %>
            <button
              type="submit"
              class="
                absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700
              "
            >
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- Checkboxes -->
      <div
        class="
          grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 overflow-visible p-4
        "
      >
        <%= render "dropdown_filter",
        dom_id_prefix: "windows-types",
        label_text: "Windows Type",
        items: @windows_types,
        param_name: :windows_types %>

        <%= render "categories_fields", metadata: @metadata %>

        <%= render "dropdown_filter",
        dom_id_prefix: "sectors",
        label_text: "Service Population",
        items: @sectors.reject { |sector| sector.name == "Other" },
        param_name: :sectors %>

        <%= render "inactive_fields" if current_user.super_user? %>
      </div>

      <div>
        <hr class="border-gray-300 my-6">
      </div>
      <!-- Filters Applied -->
      <div class="mt-6">
        <%= render "filters_applied" %>
      </div>
      <!-- Divider -->
      <div>
        <hr class="border-gray-300 my-6">
      </div>
      <!-- Sort Options -->
      <div class="flex flex-wrap items-center gap-x-4 gap-y-2 font-medium">
        <h3 class="text-sm font-semibold uppercase text-gray-500 tracking-wide">Sort by</h3>
        <%= render "sortable_fields" %>
      </div>

      <div>
        <hr class="border-gray-300 my-6">
      </div>
      <!-- Workshops List -->
      <div class="mt-6">
        <% if @workshops.any? %>
          <div id="workshops-list" class="space-y-4">
            <% @workshops.each do |workshop| %>
              <%= render "workshops/index_row",
              workshop: workshop.decorate,
              breadcrumb: "Search Curriculum",
              link_route: workshop_path(workshop) %>
            <% end %>
          </div>

          <div class="pagination mt-6">
            <%= will_paginate @workshops,
            previous_label: "<<",
            next_label: ">>",
            inner_window: 2,
            class: "will-paginate-wrapper flex space-x-2 list-none p-0" %>
          </div>

        <% else %>
          <p class="text-gray-600">Your search returned no results. Please try again.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".category-checkbox").forEach(function(checkbox) {
            checkbox.addEventListener("change", function() {
                this.form.submit();
            });
        });
    });
</script>
